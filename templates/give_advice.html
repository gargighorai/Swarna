{% extends 'base.html' %}
{% block content %}
<h6 class="col-md-12 text-center">Give Advice for {{ patient.name }}</h6>
<style>
 .selected{
  width: 50%;
  height: 100%;
  border: none;
  font-size: 12px;
  color: blue;
 }
 .button{
  color: red;
 }
 .li{
  color: red;
 }
 .removeBtn{
  height: 18px;
  padding: 0%;
  vertical-align: center;
  width: 14px;
  border: none;
  background-color: red;
  color: white;
  margin: 1px;

 }
 .availDrug{
  max-height:300px; 
  overflow-y:auto;
  font-size: 12px;
  color: rgb(9, 12, 56);
  background-color: beige;
 }
</style>
<form method="POST" id="adviceForm">
    <!-- Selected Drugs -->
  <div class="container-fluid">
    <div class="d-flex">
       <div class=" selected col-md-6">
            <label class="form-label">Selected Drugs:</label>
            <div id="selected-drugs" class="border p-2" style="min-height:200px;">
                <em class="text-muted" >No drugs selected</em>
            </div>
        </div>
        <div class="available col-md-6">
            <label class="form-label">Available Drugs:</label>
            <div id="drug-list" class="availDrug border p-2" 
            style="max-height:300px; overflow-y:auto;">
                <!-- drugs will be loaded here -->
            </div>
        </div>
    </div>

    <br>
    <button type="submit" class="btn btn-primary">Save Advice</button>
</div>
  </form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const drugList = document.getElementById("drug-list");
    const selectedDrugs = document.getElementById("selected-drugs");

    // Fetch drugs from server
    fetch("/api/drugs")
        .then(response => response.json())
        .then(data => {
            data.forEach(drug => {
                let li = document.createElement("li");
                li.className = "list-group-item list-group-item-action";
                li.style.cursor = "pointer";
                li.textContent = drug.name;
                li.dataset.id = drug.id;

                li.addEventListener("click", function() {
                    addDrug(drug.id, drug.name);
                });

                drugList.appendChild(li);
            });
        });
   const placeholder = selectedDrugs.querySelector(".text-muted");
    if (placeholder) {
        placeholder.remove();
    }
    function addDrug(id, name) {
        // Remove placeholder
        if (selectedDrugs.querySelector(".text-muted")) {
            selectedDrugs.innerHTML = "";
        }

        // Prevent duplicate
        if (document.getElementById("drug-" + id)) {
            return;
        }

        // Create prescribed drug item
        let li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.id = "drug-" + id;

        li.innerHTML = `
            <span>${name}</span>
            <button type="button" class="removeBtn ">x</button>
            <input type="hidden" name="drugs" value="${id}">
        `;

        // Remove button action
        li.querySelector("button").addEventListener("click", function() {
            li.remove();
            if (!selectedDrugs.hasChildNodes()) {
                selectedDrugs.innerHTML = '<li class="list-group-item text-muted">No drugs selected</li>';
            }
        });

        selectedDrugs.appendChild(li);
    }
});
</script>
{% endblock %}